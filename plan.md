# 訂單系統前端功能規劃

## 一、權限與顯示設定

- [ ] 「接單」和「收益」選項僅對服務商角色顯示
- [ ] 一般會員不顯示「接單」和「收益」選項

---

## 二、訂單狀態流程

### 訂單狀態定義
- [ ] 待確認 (pending)
- [ ] 待執行 (confirmed)
- [ ] 進行中 (inprogress)
- [ ] 已結束 (completed)
- [ ] 退單 (refunded)
- [ ] **移除「取消」狀態**，統一改用「退單」

### 訂單狀態轉換（前端顯示）
- [ ] 待確認 → 待執行（服務商確認接單後）
- [ ] 待執行 → 進行中（服務商確認報到後）
- [ ] 進行中 → 已結束（時間到或客人確認結束）

---

## 三、待確認狀態功能 (pending)

### 客人端 UI
- [ ] 新增「我要退單」按鈕
- [ ] 實作退單申請彈窗/Modal
  - [ ] 下拉選單：選擇取消原因
  - [ ] 文字輸入框：填寫詳細原因
  - [ ] 送出按鈕

### 服務商端 UI
- [ ] 新增「確認接單」按鈕
- [ ] 新增「退單」按鈕
- [ ] 點擊「確認接單」後，訂單狀態變更為「待執行」
- [ ] 點擊「退單」後，顯示退單申請彈窗

---

## 四、待執行狀態功能 (confirmed)

### 客人端 UI
- [ ] 新增「我要退單」按鈕
- [ ] 退單流程同待確認狀態

### 服務商端 UI
- [ ] 新增「確認報到」按鈕
- [ ] 新增「退單」按鈕
- [ ] 點擊「確認報到」後，訂單狀態變更為「進行中」

---

## 五、進行中狀態功能 (inprogress)

### 客人端 UI
- [ ] 新增「開始」按鈕（開始計時）
- [ ] 新增「我要退單」按鈕
- [ ] 新增「立即續約」按鈕
  - [ ] 點擊後顯示續約表單
  - [ ] 可輸入續約時數
  - [ ] 顯示扣除點數金額
  - [ ] 送出後產生第二張訂單（續約單）
  - [ ] 丟給服務商確認接單

### 服務商端 UI
- [ ] 新增「幫客人續約」按鈕（進行中時）
  - [ ] 點擊後顯示續約表單
  - [ ] 輸入時數後產生續約單
  - [ ] 丟給客人確認或退單
- [ ] 續約訂單確認 UI
  - [ ] 顯示「確認接單」按鈕（續約單）
  - [ ] 顯示「退單」按鈕（續約單）
  - [ ] 確認接單後接續計時

### 計時器 UI
- [ ] 實作計時器顯示元件
  - [ ] 顯示剩餘時間
  - [ ] 時間到自動顯示結束狀態

### 續約訂單邏輯
- [ ] 實作續約訂單編號生成（前端）
  - [ ] 續約訂單編號規則：原訂單編號 + 轉單號（差一碼）
  - [ ] 例如：20250626-00001 → 20250626-00001-T00001
- [ ] 續約訂單資料複製（繼承原訂單資料）
- [ ] 時間差計算顯示（接續第一張單的時間）

---

## 六、已結束狀態功能 (completed)

### 客人端 UI
- [ ] 新增「確認結束」按鈕
- [ ] 實作自動確認機制（前端計時）
  - [ ] 若客人未點擊「確認結束」，自動確認

---

## 七、退單功能 UI

### 退單申請表單/Modal
- [ ] 設計統一的退單彈窗 UI
- [ ] 下拉選單：選擇退單原因
  - [ ] 服務商未回應
  - [ ] 臨時有事
  - [ ] 服務品質不佳
  - [ ] 其他原因
- [ ] 文字框：詳細說明（選填）
- [ ] 確認送出按鈕
- [ ] 取消按鈕

---

## 八、按鈕配置總覽

### 待確認狀態 (pending)
**客人端：**
- 我要退單

**服務商端：**
- 確認接單
- 退單

### 待執行狀態 (confirmed)
**客人端：**
- 我要退單

**服務商端：**
- 確認報到
- 退單

### 進行中狀態 (inprogress)
**客人端：**
- 開始
- 我要退單
- 立即續約

**服務商端：**
- 幫客人續約
- 確認接單（續約單）
- 退單（續約單）

### 已結束狀態 (completed)
**客人端：**
- 確認結束（可選，不按會自動確認）

---

## 九、前端 UI 實作細節

- [ ] 根據角色（客人/服務商）顯示/隱藏按鈕
- [ ] 根據訂單狀態動態顯示對應按鈕
- [ ] 實作退單彈窗/Modal 元件
- [ ] 實作計時器 UI 元件
- [ ] 實作續約表單/Modal 元件
- [ ] 按鈕點擊後的狀態變更邏輯

---

## 十、測試項目

- [ ] 測試角色權限（服務商/一般會員）顯示正確按鈕
- [ ] 測試待確認狀態：客人退單流程
- [ ] 測試待確認狀態：服務商接單/退單流程
- [ ] 測試待執行狀態：客人退單流程
- [ ] 測試待執行狀態：服務商報到/退單流程
- [ ] 測試進行中狀態：客人開始計時
- [ ] 測試進行中狀態：客人退單流程
- [ ] 測試進行中狀態：客人續約流程
- [ ] 測試進行中狀態：服務商幫客人續約流程
- [ ] 測試續約訂單編號生成正確
- [ ] 測試計時器顯示正確
- [ ] 測試計時器時間到自動結束
- [ ] 測試已結束狀態：客人確認結束
- [ ] 測試已結束狀態：自動確認功能

---

## 實作優先順序

### Phase 1: 基礎狀態與按鈕
1. 移除取消狀態，統一改用退單
2. 實作按鈕根據角色和訂單狀態顯示邏輯
3. 完成待確認狀態的所有按鈕和 UI

### Phase 2: 核心流程
1. 實作待執行狀態功能
2. 實作進行中狀態基本功能（開始、退單）
3. 實作已結束狀態功能

### Phase 3: 續約功能
1. 實作客人續約 UI 和流程
2. 實作服務商幫客人續約 UI 和流程
3. 實作續約訂單編號生成邏輯
4. 實作計時器 UI

### Phase 4: 整合測試
1. 完整測試所有狀態轉換
2. 測試所有按鈕功能
3. 測試續約流程
4. Bug 修復
